{"version":3,"file":"background.js","mappings":"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","sources":["webpack://my-webpack-project/webpack/bootstrap","webpack://my-webpack-project/webpack/runtime/make namespace object","webpack://my-webpack-project/./src/background/background.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nfunction start() {\n    return __awaiter(this, void 0, void 0, function () {\n        var getParamFromUrl;\n        return __generator(this, function (_a) {\n            chrome.tabs.onActivated.addListener(function (tab) {\n                // chrome.tabs.get(tab.tabId, async (currentTab) => {\n                //     await chrome.scripting.executeScript({\n                //         target: { tabId: currentTab.id },\n                //         files: ['contentModalPaste.js']\n                //     })\n                // })\n                chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {\n                    return __awaiter(this, void 0, void 0, function () {\n                        return __generator(this, function (_a) {\n                            // console.log(\"🚀 ~ tabs:\", tabs)\n                            chrome.cookies.getAll({ url: tabs[0].url }, function (cookies) {\n                                return __awaiter(this, void 0, void 0, function () {\n                                    var cookiesStr, idEntites, allEntites, currentEntites, objShow_1, currentEntitesViewers, error_1;\n                                    return __generator(this, function (_a) {\n                                        switch (_a.label) {\n                                            case 0:\n                                                cookiesStr = cookies === null || cookies === void 0 ? void 0 : cookies.map(function (item) { return \"\".concat(item.name, \"=\").concat(item.value); }).toString();\n                                                idEntites = getParamFromUrl(tabs[0].url).id;\n                                                _a.label = 1;\n                                            case 1:\n                                                _a.trys.push([1, 4, , 5]);\n                                                return [4 /*yield*/, fetch('https://pdm-kueg.io.neolant.su/api/structure/entities', {\n                                                        headers: {\n                                                            cookie: cookiesStr\n                                                        }\n                                                    })\n                                                        .then(function (e) { return e.json(); })];\n                                            case 2:\n                                                allEntites = _a.sent();\n                                                currentEntites = allEntites.find(function (item) { return item.Id === idEntites; });\n                                                console.log(\"🚀 ~ file: background.ts:30 ~ allEntites:\", allEntites);\n                                                objShow_1 = {};\n                                                allEntites.forEach(function (item) {\n                                                    var _a, _b;\n                                                    if (!((_a = item.Parent) === null || _a === void 0 ? void 0 : _a.Id))\n                                                        return;\n                                                    var key = (_b = item.Parent) === null || _b === void 0 ? void 0 : _b.Id;\n                                                    // if (item.Id !== idEntites) return\n                                                    if (Array.isArray(objShow_1[key])) {\n                                                        objShow_1[key].push({\n                                                            name: item.Name,\n                                                            id: item.Parent\n                                                        });\n                                                    }\n                                                    else {\n                                                        objShow_1[key] = [{\n                                                                name: item.Name,\n                                                                id: item.Parent\n                                                            }];\n                                                    }\n                                                });\n                                                console.log(\"🚀 ~ file: background.ts:31 ~ objShow:\", objShow_1);\n                                                currentEntitesViewers = currentEntites === null || currentEntites === void 0 ? void 0 : currentEntites.Viewers;\n                                                if (!currentEntitesViewers)\n                                                    return [2 /*return*/];\n                                                return [4 /*yield*/, chrome.runtime.sendMessage({\n                                                        message: {\n                                                            action: 'viewers',\n                                                            payload: currentEntitesViewers\n                                                        }\n                                                    })];\n                                            case 3:\n                                                _a.sent();\n                                                return [3 /*break*/, 5];\n                                            case 4:\n                                                error_1 = _a.sent();\n                                                return [3 /*break*/, 5];\n                                            case 5: return [2 /*return*/];\n                                        }\n                                    });\n                                });\n                            });\n                            return [2 /*return*/];\n                        });\n                    });\n                });\n            });\n            getParamFromUrl = function (url) {\n                // Разбиваем строку запроса на отдельные параметры\n                var params = new URLSearchParams(url);\n                // Создаем пустой объект для хранения параметров\n                var paramsObj = {};\n                // Проходимся по всем параметрам и добавляем их в объект\n                params.forEach(function (value, key) {\n                    var keyArr = key === null || key === void 0 ? void 0 : key.split(\"?\");\n                    var keyValue = keyArr.length > 1 ? keyArr[1] : keyArr[0];\n                    paramsObj[keyValue] = value;\n                });\n                return paramsObj;\n            };\n            return [2 /*return*/];\n        });\n    });\n}\nstart();\nexport {};\n"],"names":["__webpack_require__","r","exports","Symbol","toStringTag","Object","defineProperty","value","__awaiter","thisArg","_arguments","P","generator","adopt","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","iterator","this","n","v","op","TypeError","call","pop","length","push","start","getParamFromUrl","_a","chrome","tabs","onActivated","addListener","tab","query","active","currentWindow","cookies","getAll","url","cookiesStr","idEntites","allEntites","currentEntites","objShow_1","currentEntitesViewers","error_1","map","item","concat","name","toString","id","fetch","headers","cookie","json","find","Id","console","log","forEach","_b","Parent","key","Array","isArray","Name","Viewers","runtime","sendMessage","message","action","payload","params","URLSearchParams","paramsObj","keyArr","split","keyValue"],"sourceRoot":""}